<html lang="en">
<head>
    <link href="fonts.css" rel="stylesheet">
    <link href="login.css" rel="stylesheet">
    <link href="global.css" rel="stylesheet">
    <title>Jimbo</title>
</head>
<body>
<div style="display:flex; flex-direction: column;">
    <a id="title" class="header">Escape: A Storey</a>
    <form onsubmit="tryAuth()" id="center-box">
        <a id="welcome-text" class="header" style="font-size: 22px">Login</a>
        <input type="text" id="username" class="entry-box floating-box" placeholder="Username">
        <div id="password-enter-container">
            <input type="password" id="password" class="entry-box floating-box" placeholder="Password" onsubmit="tryAuth()">
            <button id="enter-box" class="floating-box"
                    onclick="tryAuth()">
                &rarr;
            </button>
        </div>
        <a id="auth-error"></a>
        <div id="auth-change-container">
            <a id="auth-prompt">New?</a>
            <a id="auth-change" class="logical-button" style="font-style: normal;" onclick="toggleAuthMode()">[<u><b>C</b></u>reate an account]</a>
        </div>
    </form>
    <div class="corner-flair"></div>
</div>

<script>
    /**
     * @type {{toggleAuthMode: () => [ String, string, string ], tryAuth: (user: string, pass: string) => string}}
     */
    window.app = window.app || {};

    /**
     * Update the key handler to click auth change if {@link key} is pressed
     * @param {string} key - The key to compare the pressed key with.
     */
    function updateKeyHandler(key) {
        document.onkeydown = event => {
            let eventKey;
            if (event.keyIdentifier === undefined) eventKey = event.key; else try {
                eventKey = String.fromCodePoint('0x' + event.keyIdentifier.substring(2)).toLowerCase()
            } catch (_) {
                return
            }

            if (eventKey === key) document.getElementById('auth-change').click()
        }
    }

    /**
     * Toggle the auth mode and change messaging to reflect the change.
     */
    function toggleAuthMode() {
        let j = app.toggleAuthMode()
        let [prompt, change, welcome] = j.map(it=>it.toString())
        document.getElementById('auth-prompt').innerText = prompt
        document.getElementById('welcome-text').innerText=welcome
        document.getElementById('auth-change').innerHTML = `[<u><b>${change.charAt(0)}</b></u>${String(change).substring(1)}]`
        updateKeyHandler(change.charAt(0).toLowerCase())
    }

    /**
     * Try to authenticate with the currently typed credentials.
     */
    function tryAuth() {
        document.getElementById('auth-error').innerText = app.tryAuth(document.getElementById('username').value, document.getElementById('password').value)
    }
    addEventListener('submit', ev => ev.preventDefault());
</script>
</body>

</html>